<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chris Calendar</title>
    <style>
        /* General styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
        }

        h1 {
            text-align: center;
            background-color: #f39200;
            color: white;
            margin: 0;
            padding: 15px;
        }

        .filtered-section {
            padding-left: 33px;
            padding-right: 33px;
        }

        .filtered-section > .day-header {
            padding-left: 3px;
            padding-right: 3px;
        }

        /* Styles for calendar */
        .default {
            display: block;
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .filtered-section > div {
            padding: 10px;
            background-color: #ffffff;
            text-align: center;
        }

        .filtered-section > div > div {
            display: block;
            padding: 8px;
        }

        .row-entry {
            text-align: center;
            border: 1px solid #f39200;
            border-radius: 8px;
            display: block;
            padding-bottom: 4px;
            margin-bottom: 8px;
        }

        .row-entry > p:first-child {
            font-weight: bold;
        }

        .row-entry > p {
            margin: 0;
        }

        .day-header {
            border-top: 1px solid #ddd;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: space-between; /* Space out the child elements */
            align-items: center; /* Vertically center the elements */
            width: 100%; /* Ensure the header takes the full width */
        }

        .day-header > :first-child {
            margin-right: auto; /* Anchors the first element to the left */
        }

        .day-header > :nth-child(2) {
            margin-left: auto; /* Anchors the second element to the center */
        }

        #day-headers {
            display: none !important; /* Ensure day headers are hidden and take no space */
        }


        .collapse-btn {
            background-color: #f39200;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .collapse-btn:hover {
            background-color: #ad6b00;
        }

        .center-container {
            padding: 12px;
            display: flex;
            flex-direction: column; /* Stack items vertically */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center horizontally */
        }

        .collapse-btn {
            margin: 8px 0; /* Add spacing between buttons */
            height: 32px;
        }
        .hidden-content {
            display: none;
        }

        .scroll-down {
            display: none;
        }

        select, input[type="button"] {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }

        .filter-item {
            margin-bottom: 10px;
        }



        label {
            font-weight: bold;
            display: block;
            padding: 6px;
        }
    </style>
</head>
<body>
<h1>Chris Ball Kalender</h1>
<div class="center-container">
    <button class="collapse-btn" onclick="window.location.href = '/'">Zu Kursterminen wechseln</button>
    <button class="collapse-btn" id="hideall">Hide All</button>
</div>
<div id="calendar-container">
    Loading calendar...
</div>

<script>

    const btns = [];

    async function fetchCalendar() {
        try {
            document.getElementById('calendar-container').innerText = 'Loading calendar...';
            const response = await fetch(`https://corsproxy.io/?url=${encodeURIComponent("https://www.tanzschulechris.at/events/baelle/ballproben")}`);

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const htmlText = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, 'text/html');
            // Find all containers with the "container default" class
            const containers = doc.querySelectorAll(".container.default");

            // Create a result container
            const resultContainer = document.createElement("div");

            // Iterate through each container
            containers.forEach((container) => {
                // Check if there are any <tr> elements inside this container
                const rows = container.querySelectorAll("tr");
                if (rows.length > 0) {
                    // Find the header element (if any)
                    const header = container.querySelector("h2");

                    // Create a section for this container
                    const section = document.createElement("div");
                    section.className = "filtered-section";

                    // Add the header text
                    if (header) {
                        const headerElement = document.createElement("div");
                        const name = document.createElement("p");
                        headerElement.classList.add('day-header');
                        name.textContent = header.textContent;
                        headerElement.appendChild(name);
                        section.appendChild(headerElement);


                    }

                    rows.forEach((row) => {
                        // Create a container for the row
                        const listItem = document.createElement("div");
                        listItem.className = "row-entry";

                        let firstChild;
                        // Extract text from the row's <td> elements and create <p> for each column
                        Array.from(row.querySelectorAll("td")).forEach((cell) => {
                            if (!firstChild) {
                                const paragraph = document.createElement("p");
                                paragraph.textContent = cell.textContent.trim(); // Set text for each <p>
                                listItem.appendChild(paragraph); // Append <p> to the row entry
                                firstChild = paragraph;
                            } else {
                                firstChild.textContent += ' | ' + cell.textContent.trim();
                                firstChild = undefined;
                            }

                        });
                        // Append the row entry to the section
                        section.appendChild(listItem);
                    });


                    // Append the section to the result container
                    resultContainer.appendChild(section);

                }
            });

            const calendarContainer = document.getElementById('calendar-container');
            if (containers.length > 0) {
                calendarContainer.innerHTML = resultContainer.outerHTML;
                addCollapseFeature();
            } else {
                calendarContainer.textContent = 'Calendar not found in the response. This should not happen. This site for sure correctly works on Chrome and Firefox, maybe switch to other browser?';
            }
        } catch (error) {
            console.error('Error fetching calendar:', error);
            document.getElementById('calendar-container').textContent = 'Failed to load calendar.';
        }
    }

    function addCollapseFeature() {
        // Select all elements with the class "day-header"
        const dayHeaders = document.querySelectorAll('.day-header');

        const allButton = document.getElementById('hideall');
        allButton.textContent = 'Hide All';
        const allToggle = () => {
            if (allButton.textContent === 'Show All') {
                allButton.textContent = 'Hide All';
                btns.forEach(btn => {
                    if (btn.textContent === 'Show') {
                        btn.click();
                    }
                });
                localStorage.removeItem('hideall');
            } else {
                allButton.textContent = 'Show All';
                btns.forEach(btn => {
                    if (btn.textContent === 'Hide') {
                        btn.click();
                    }
                });
                localStorage.setItem('hideall', '1');
            }

        };
        allButton.addEventListener('click', allToggle);

        dayHeaders.forEach(dayHeader => {
            // Create a button for toggling visibility of "course" entries
            const toggleButton = document.createElement('button');
            toggleButton.textContent = 'Hide';
            toggleButton.classList.add('collapse-btn');

            // Insert the button before the first <p> element inside the "day-header"
            const firstParagraph = dayHeader.querySelector('p');
            if (firstParagraph.nextSibling) {
                dayHeader.insertBefore(toggleButton, firstParagraph.nextSibling);
            } else {
                dayHeader.appendChild(toggleButton);
            }

            const toggleCollapse = () => {
                let sibling = dayHeader.nextElementSibling;
                toggleButton.textContent = toggleButton.textContent !== 'Hide' ? 'Hide' : 'Show';

                // Loop through the following siblings
                while (sibling && sibling.classList.contains('row-entry')) {
                    sibling.style.display = sibling.style.display === 'none' ? '' : 'none';
                    sibling = sibling.nextElementSibling;
                }
            }

            // Attach click event to toggle visibility of "course" entries
            toggleButton.addEventListener('click', toggleCollapse);
            btns.push(toggleButton);
        });
        if (localStorage.getItem('hideall')) {
            allButton.click();
        } else {

        }
    }

    // Fetch calendar when the page loads
    fetchCalendar();


</script>
</body>
</html>
